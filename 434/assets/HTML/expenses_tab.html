<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expenses</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            width: 640px;
            height: 960px;
            overflow: hidden;
            margin: 0 auto;
            background-color: #3e3e3e;
        }
        
        body {
            border: 1px solid #ccc;
            padding: 20px;
        }
        
        .input-container {
            margin-bottom: 20px;
        }
        
        .input-field {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 8px;
            outline: none;
            transition: border-color 0.3s;
        }
        
        .input-field:focus {
            border-color: #4CAF50;
        }
        
        .btn {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            background-color: #4CAF50;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .btn:hover {
            background-color: #45a049;
        }
        .history-container {
            margin-top: 20px;
            max-height: 600px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            background-color: #fff;
        }
        span.spent-transaction {
            background-color: red;
        }
        span.gained-transition {
            background-color: green;
        }
        
        /* Manage Recurring overlay */
        .manage-overlay {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 640px;
            height: 960px;
            background: #ffffff;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden auto;
            z-index: 1000;
            padding: 16px;
        }
        .manage-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }
        .manage-header h2 {
            margin: 0;
            color: #333;
            font-size: 18px;
        }
        .recurring-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .empty-state {
            color: #666;
            font-size: 14px;
            padding: 16px 0;
        }

    </style>
</head>
<body>
    <div class="addNewTransaction">
        <button id="addTransactionBtn" class="btn" onclick="addTransaction()" style="display: block">Add Transaction</button>
        <button id="createRecurringTransactionBtn" class="btn" onclick="createRecurringTransaction()" style="display: block">Create Recurring Transaction</button>
        <button id="manageRecurringBtn" class="btn" onclick="showManageRecurring()" style="display: block">Manage Recurring</button>
    </div>

    <div id="add-input-container"class="input-container" style="display: none">
        <select id="categorySelect" class="input-field">
            <option value="spent">Spent</option>
            <option value="gained">Gained</option>
        </select>
        <input type="text" id="titleInput" class="input-field" placeholder="Title">
        <input type="number" id="amountInput" class="input-field" placeholder="Amount">
        <input type="date" id="dateInput" class="input-field" placeholder="Date">
        <input type="time" id="timeInput" class="input-field" placeholder="Time"> 
        <button class="btn" onclick="enterExpense()">Enter</button>
        <button class="btn" onclick="cancelEnterExpense()">Cancel</button>
        
    </div>

    <div id="create-input-container" class="input-container" style="display: none">
        <select id="createCategorySelect" class="input-field">
            <option value="spent">Spent</option>
            <option value="gained">Gained</option>
        </select>
        <input type="text" id="createTitleInput" class="input-field" placeholder="Title">
        <input type="number" id="createAmountInput" class="input-field" placeholder="Amount">
        <button class="btn" onclick="createExpense()">Create</button>
        <button class="btn" onclick="cancelCreateExpense()">Cancel</button>    
    </div>

    <div id="error-message-container" class="error-message-container" style="display: none;">    
            <span class="error-message" style="color: red;"> Must complete all fields!</span>
    </div>
    <div id="created-message-container" class="created-message-container" style="display: none;">    
            <span class="created-message" style="color: green;"> Created successfully!</span>
    </div>

    <h1>History</h1>
        <button class="btn" onclick="toggleHistory()">Toggle History</button>
    <div id="transactionHistory" class="history-container"  style="display: none;">

    </div>
    
    <!-- Manage Recurring overlay -->
    <div id="manage-recurring-container" class="manage-overlay" style="display: none;">
        <div class="manage-header">
            <button class="btn" onclick="toggleDisplay('manage-recurring-container', 'none')">Back</button>
            <h2>Manage Recurring</h2>
        </div>
      
        <div id="recurringList" class="recurring-list">
            <!-- Recurring transactions will be rendered here -->
        </div>
      
        <div id="recurringEmpty" class="empty-state" style="display: none;">
            No recurring transactions yet.
        </div>
    </div>
    
    <script>
        let transactions = []; // Array to hold transaction history
        let recurringTransactions = [];

        function loadTransactions() {
            const saved = localStorage.getItem('transactions');
            if (saved) {
                transactions = JSON.parse(saved)
            }
            displayTransactions()
        }

        loadTransactions();

        function loadRecurringTransactions() {
            const saved = localStorage.getItem('recurringTransactions');
            if (saved) {
                recurringTransactions = JSON.parse(saved)
            }
        }

        loadRecurringTransactions();

        function setDefaultDateToToday(id) {
            const dateEl = document.getElementById(id);
            if (!dateEl) return;
            const today = new Date().toISOString().split('T')[0];
            dateEl.value = today;
        }

        function setDefaultTimetoToday(id) {
            const timeEl = document.getElementById(id);
            if (!timeEl) return;
            const now = new Date();
            const hh = String(now.getHours()).padStart(2, '0');
            const mm = String(now.getMinutes()).padStart(2, '0');
            timeEl.value = `${hh}:${mm}`;
        }

        function enterExpense() {

            const amount = document.getElementById('amountInput').value;
            const category = document.getElementById('categorySelect').value;
            const title = document.getElementById('titleInput').value;
            const date = document.getElementById('dateInput').value;
            const time = document.getElementById('timeInput').value;

            const transaction = {
                title: title,
                type: category,
                amount: amount,
                date: date,
                time: time
            }

            if (transaction.title == ''|| transaction.amount == '' || !transaction.date || !transaction.time) {
                displayErrorMessage()
                return;
            }

            transactions.push(transaction)

            localStorage.setItem("transactions", JSON.stringify(transactions)) 

            document.getElementById('amountInput').value = ''; // Clear input field
            document.getElementById('titleInput').value = ''; // Clear input field
            displayTransactions()
            toggleDisplay("add-input-container", "none");
            toggleDisplay("addTransactionBtn", "block");
            toggleDisplay("createRecurringTransactionBtn", "block");

        }

        function addTransaction() {
            toggleDisplay("createRecurringTransactionBtn", "none");
            toggleDisplay("addTransactionBtn", "none");

            setDefaultDateToToday("dateInput");
            setDefaultTimetoToday("timeInput");
            toggleDisplay("add-input-container", "block");
        }

        function cancelEnterExpense() {
            document.getElementById('amountInput').value = ''; // Clear input field
            document.getElementById('titleInput').value = ''; // Clear input field
            toggleDisplay("add-input-container", "none");
            toggleDisplay("addTransactionBtn", "block");
            toggleDisplay("createRecurringTransactionBtn", "block");

        }

        function displayTransactions() {
            organizeTransactionsByDate();
            const historyDiv = document.getElementById("transactionHistory")

            historyDiv.innerHTML = '';

            for (let i = transactions.length-1; i >= 0; i--) {
                const t = transactions[i]
                const type = t.type

                historyDiv.innerHTML += `
                    <div class="${type}-transaction">
                        <span class="transaction-title">${t.title || ''}</span>
                        <span class="${type}">$${t.amount}</span>
                        <span class="transaction-type">${t.type}</span>
                        <span class="transaction-date">${t.date}</span>
                        <span class="transaction-time">${t.time}</span>
                        <button onclick="deleteTransaction(${i})">Delete</button>
                    </div>
                `;
            }
            
        }

        function deleteTransaction(i) {           
            transactions.splice(i, 1);
            localStorage.setItem("transactions", JSON.stringify(transactions))
            displayTransactions()
        }

        function createRecurringTransaction() {
            toggleDisplay("addTransactionBtn", "none");
            toggleDisplay("createRecurringTransactionBtn", "none");

            const createInputDiv = document.getElementById("create-input-container");
            if (createInputDiv.style.display === "none" || createInputDiv.style.display === "") {
                createInputDiv.style.display = "block";
            } else {
                createInputDiv.style.display = "none";
            }
        }

        function createExpense() {
            const amount = document.getElementById('createAmountInput').value;
            const category = document.getElementById('createCategorySelect').value;
            const title = document.getElementById('createTitleInput').value;

            const transaction = {
                title: title,
                type: category,
                amount: amount
            }

            if (transaction.title == ''|| transaction.amount == '') {
                displayErrorMessage()
                return;
            }

            recurringTransactions.push(transaction)

            localStorage.setItem("recurringTransactions", JSON.stringify(recurringTransactions)) 

            document.getElementById('createAmountInput').value = ''; // Clear input field
            document.getElementById('createTitleInput').value = ''; // Clear input field

            toggleDisplay("create-input-container", "none");
            toggleDisplay("addTransactionBtn", "block");
            toggleDisplay("createRecurringTransactionBtn", "block");
            displayCreatedMessage();
        }


        function cancelCreateExpense() {
            document.getElementById('createAmountInput').value = ''; // Clear input field
            document.getElementById('createTitleInput').value = ''; // Clear input field
            toggleDisplay("create-input-container", "none");
            toggleDisplay("addTransactionBtn", "block");
            toggleDisplay("createRecurringTransactionBtn", "block");
        }

        function showManageRecurring() {
            const manageDiv = document.getElementById("manage-recurring-container");
            if (manageDiv.style.display === "none" || manageDiv.style.display === "") {
                manageDiv.style.display = "block";
            } else {
                manageDiv.style.display = "none";
            }
            // Update empty state visibility when showing
            const empty = document.getElementById('recurringEmpty');
            if (manageDiv.style.display === 'block') {
                if (Array.isArray(recurringTransactions) && recurringTransactions.length > 0) {
                    empty.style.display = 'none';
                } else {
                    empty.style.display = 'block';
                }
            }
            displayRecurringTransactions();
        }

        function displayRecurringTransactions() {
            organizeRecurringTransactionsByName();
            const recurringListDiv = document.getElementById("recurringList")

            recurringListDiv.innerHTML = '';

            for (let i = 0; i < recurringTransactions.length; i++) {
                const t = recurringTransactions[i]
                const type = t.type

                recurringListDiv.innerHTML += `
                    <div class="recurring-${type}-transaction">
                        <span class="recurring-transaction-title">${t.title || ''}</span>
                        <span class="${type}">$${t.amount}</span>
                        <span class="recurring-transaction-type">${t.type}</span>
                        <button onclick="deleteRecurringTransaction(${i})">Delete</button>
                        <button onclick="showAddtoHistory(${i})">Add to History</button>
                        <input type="date" id="recurringDateInput" class="input-field" placeholder="Date" style="display: none;">
                        <input type="time" id="recurringTimeInput" class="input-field" placeholder="Time" style="display: none;"> 
                        <button id="confirmRecurringBtn${i}" onclick="addRecurringToHistory(${i})" style="display: none;">Confirm</button>
                        <button id="cancelRecurringBtn${i}" onclick="cancelAddToHistory(${i})" style="display: none;">Cancel</button>
                    </div>
                `;
            }
        }

        function deleteRecurringTransaction(i) {
            recurringTransactions.splice(i, 1);
            localStorage.setItem("recurringTransactions", JSON.stringify(recurringTransactions))
            displayRecurringTransactions()
        }

        function showAddtoHistory(i) {
            setDefaultDateToToday("recurringDateInput");
            setDefaultTimetoToday("recurringTimeInput");
            toggleDisplay("confirmRecurringBtn"+i, "block");
            toggleDisplay("cancelRecurringBtn"+i, "block");
            toggleDisplay("recurringDateInput", "block");
            toggleDisplay("recurringTimeInput", "block");
        }

        function addRecurringToHistory(i) {
            const t = recurringTransactions[i];
            const date = document.getElementById("recurringDateInput").value;
            const time = document.getElementById("recurringTimeInput").value;

            const transaction = {
                title: t.title,
                type: t.type,
                amount: t.amount,
                date: date,
                time: time
            };

            transactions.push(transaction);
            localStorage.setItem("transactions", JSON.stringify(transactions))
            displayTransactions()
            cancelAddToHistory(i);

            makeToast(`Added ${t.title || 'transaction'} to history`);
        }

        function cancelAddToHistory(i) {
            document.getElementById("recurringDateInput").value = '';
            document.getElementById("recurringTimeInput").value = '';
            toggleDisplay("confirmRecurringBtn"+i, "none");
            toggleDisplay("cancelRecurringBtn"+i, "none");
            toggleDisplay("recurringDateInput", "none");
            toggleDisplay("recurringTimeInput", "none");
        }
        function toggleHistory() {
            const historyDiv = document.getElementById("transactionHistory");
            if (historyDiv.style.display === "none" || historyDiv.style.display === "") {
                toggleDisplay("transactionHistory", "block");
            } else {
                toggleDisplay("transactionHistory", "none");
            }
        }

        function displayErrorMessage() {
            const box = document.getElementById('error-message-container');
            box.style.display = 'block';
            setTimeout(() => { box.style.display = 'none'; }, 2500);
        }

        function displayCreatedMessage() {
            const box = document.getElementById('created-message-container');
            box.style.display = 'block';
            setTimeout(() => { box.style.display = 'none'; }, 2500);
        }

        function makeToast(message) {
            // show a small toast confirmation
        
            const toast = document.createElement('div');
            toast.textContent = message;
            Object.assign(toast.style, {
                position: 'fixed',
                left: '50%',
                bottom: '24px',
                transform: 'translateX(-50%) translateY(8px)',
                background: 'rgba(0,0,0,0.85)',
                color: '#fff',
                padding: '10px 16px',
                borderRadius: '6px',
                fontSize: '14px',
                boxShadow: '0 6px 18px rgba(0,0,0,0.25)',
                opacity: '0',
                transition: 'opacity 260ms ease, transform 260ms ease',
                zIndex: 9999,
                pointerEvents: 'none'
            });
            document.body.appendChild(toast);
            // trigger enter animation
            requestAnimationFrame(() => {
                toast.style.opacity = '1';
                toast.style.transform = 'translateX(-50%) translateY(0)';
            });
            // hide after 2.5s
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(-50%) translateY(8px)';
                setTimeout(() => toast.remove(), 300);
            }, 2500);
            
        }

        function toggleDisplay(id, displayState) {
            const element = document.getElementById(id);
            if (element) {
                element.style.display = displayState;
            }
        }

        function organizeTransactionsByDate() {
            transactions.sort((a, b) => {
                const dateA = new Date(`${a.date}T${a.time}`);
                const dateB = new Date(`${b.date}T${b.time}`);
                return dateA - dateB;
            });
            localStorage.setItem("transactions", JSON.stringify(transactions));
        }

        function organizeRecurringTransactionsByName() {
            recurringTransactions.sort((a, b) => {
                const nameA = a.title.toLowerCase();
                const nameB = b.title.toLowerCase();
                if (nameA < nameB) return -1;
                if (nameA > nameB) return 1;
                return 0;
            });
            console.log(recurringTransactions);
            localStorage.setItem("recurringTransactions", JSON.stringify(recurringTransactions));
        }

    </script>

</body>
</html>