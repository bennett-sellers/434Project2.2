<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prototype - Goals</title>
    <link rel="stylesheet" href="css/styles.css">
  </head>

  <body>
    <div class="device">
      <div id="Goals" class="tabcontent" style="display: block;">
        <h1>Goals</h1>
        <div style="height: 620px; width: 500px; overflow: auto; padding: 10px; box-sizing: border-box;">

        


<div style="display:flex; flex-direction:column; gap:10px; text-align:left;">
  <label>
    1) Current monthly income ($)
    <input id="g_monthlyIncome" type="number" min="0" step="0.01"
           placeholder="e.g., 3200"
           style="width:100%; box-sizing:border-box; padding:8px; margin-top:4px;" />
  </label>

  <label>
    2) Weekly expenses ($/week)
    <input id="g_weeklyExpenses" type="number" min="0" step="0.01"
           placeholder="e.g., 450"
           style="width:100%; box-sizing:border-box; padding:8px; margin-top:4px;" />
  </label>

  <label>
    3) Saving goal (total $ to save)
    <input id="g_savingGoal" type="number" min="0" step="0.01"
           placeholder="e.g., 1000"
           style="width:100%; box-sizing:border-box; padding:8px; margin-top:4px;" />
  </label>

  <label>
    4) How long do you want to save? (days)
    <input id="g_durationDays" type="number" min="1" step="1"
           placeholder="e.g., 30"
           style="width:100%; box-sizing:border-box; padding:8px; margin-top:4px;" />
  </label>

  <button onclick="g_calculateGoalFeasibility()"
          style="align-self:flex-start; padding:10px 16px; cursor:pointer;">
    Calculate Plan
  </button>
</div>

<div id="g_goalMessage" style="margin-top:12px; font-weight:700;"></div>

<div id="g_goalOutput"
     style="display:none; color:#222; margin-top:10px; padding:12px; background:#fff; border-radius:6px;">
</div>

<p style="margin-top:10px; font-size:12px; opacity:.9;">
  <em>Assumptions:</em> For planning we approximate 30 days/month and 7 days/week.
</p>

<script>
  // Keep everything scoped to "g_*" to avoid conflicts with existing scripts
  function g_currency(n) { return "$" + Number(n).toFixed(2); }

  function g_calculateGoalFeasibility() {
    const monthlyIncome = parseFloat(document.getElementById("g_monthlyIncome").value);
    const weeklyExpenses = parseFloat(document.getElementById("g_weeklyExpenses").value);
    const savingGoal    = parseFloat(document.getElementById("g_savingGoal").value);
    const durationDays  = parseInt(document.getElementById("g_durationDays").value, 10);

    const msgEl = document.getElementById("g_goalMessage");
    const outEl = document.getElementById("g_goalOutput");

    // Reset UI
    msgEl.textContent = "";
    msgEl.style.color = "inherit";
    outEl.style.display = "none";
    outEl.innerHTML = "";

    // Validate (inline, no popups)
    if (
      isNaN(monthlyIncome) || isNaN(weeklyExpenses) ||
      isNaN(savingGoal) || isNaN(durationDays) ||
      monthlyIncome < 0 || weeklyExpenses < 0 ||
      savingGoal < 0 || durationDays < 1
    ) {
      msgEl.textContent = "Please enter valid non-negative numbers (days must be at least 1).";
      msgEl.style.color = "#b30000";
      return;
    }

    // Normalize to per-day (approx 30-day month, 7-day week)
    const incomePerDay   = monthlyIncome / 30.0;
    const expensePerDay  = weeklyExpenses / 7.0;

    const incomeTotal    = incomePerDay  * durationDays;
    const expenseTotal   = expensePerDay * durationDays;

    const netPerDay      = incomePerDay - expensePerDay;              // leftover/day
    const maxSavable     = Math.max(0, incomeTotal - expenseTotal);   // max possible savings
    const neededPerDay   = savingGoal / durationDays;
    const neededPerWeek  = neededPerDay * 7;

    // Summary HTML
    const summaryHTML = `
      <h3 style="margin:8px 0 12px 0;">Plan Summary</h3>
      <table style="width:100%; border-collapse:collapse;">
        <tbody>
          <tr><td style="padding:6px; border-bottom:1px solid #eee;">Monthly income</td>
              <td style="padding:6px; text-align:right; border-bottom:1px solid #eee;">${g_currency(monthlyIncome)}</td></tr>
          <tr><td style="padding:6px; border-bottom:1px solid #eee;">Weekly expenses</td>
              <td style="padding:6px; text-align:right; border-bottom:1px solid #eee;">${g_currency(weeklyExpenses)}</td></tr>
          <tr><td style="padding:6px; border-bottom:1px solid #eee;">Timeline</td>
              <td style="padding:6px; text-align:right; border-bottom:1px solid #eee;">${durationDays} days</td></tr>
          <tr><td style="padding:6px; border-bottom:1px solid #eee;">Goal</td>
              <td style="padding:6px; text-align:right; border-bottom:1px solid #eee;">${g_currency(savingGoal)}</td></tr>
          <tr><td style="padding:6px; border-bottom:1px solid #eee;">Estimated income over timeline</td>
              <td style="padding:6px; text-align:right; border-bottom:1px solid #eee;">${g_currency(incomeTotal)}</td></tr>
          <tr><td style="padding:6px; border-bottom:1px solid #eee;">Estimated expenses over timeline</td>
              <td style="padding:6px; text-align:right; border-bottom:1px solid #eee;">${g_currency(expenseTotal)}</td></tr>
          <tr><td style="padding:6px; border-bottom:1px solid #eee;">Maximum savable over timeline</td>
              <td style="padding:6px; text-align:right; border-bottom:1px solid #eee; font-weight:600;">${g_currency(maxSavable)}</td></tr>
        </tbody>
      </table>
      <div style="margin-top:12px;">
        <div>Required saving rate: <strong>${g_currency(neededPerDay)}/day</strong> (${g_currency(neededPerWeek)}/week)</div>
        <div>Estimated leftover after expenses: <strong>${g_currency(netPerDay)}/day</strong></div>
      </div>
    `;

    // Reasonableness check
    const unreasonable = (savingGoal > maxSavable + 1e-6) || (neededPerDay > netPerDay + 1e-6);

    if (unreasonable) {
      msgEl.innerHTML = "⚠️ <strong>This goal looks unreasonable with the current numbers.</strong> Consider editing your plan.";
      msgEl.style.color = "#b30000";

      // Suggestions
      let suggestionsHTML = "";
      if (netPerDay > 0) {
        const minDaysNeeded = Math.ceil(savingGoal / netPerDay);
        suggestionsHTML += `<li>Increase the timeline to about <strong>${minDaysNeeded} days</strong>.</li>`;
      } else {
        suggestionsHTML += `<li>Your expenses meet or exceed income. Reduce expenses or increase income so leftover/day is positive.</li>`;
      }

      // Target weekly expenses to make plan feasible
      const targetExpensePerDay = incomePerDay - neededPerDay;
      if (targetExpensePerDay >= 0) {
        const targetWeekly = targetExpensePerDay * 7;
        const weeklyCut = Math.max(0, weeklyExpenses - targetWeekly);
        if (weeklyCut > 0) {
          suggestionsHTML += `<li>Reduce weekly expenses by about <strong>${g_currency(weeklyCut)}</strong>.</li>`;
        }
      }

      // Target monthly income to make plan feasible
      const neededMonthlyIncome = 30 * (neededPerDay + expensePerDay);
      const incomeIncrease = Math.max(0, neededMonthlyIncome - monthlyIncome);
      if (incomeIncrease > 0) {
        suggestionsHTML += `<li>Increase monthly income by about <strong>${g_currency(incomeIncrease)}</strong>.</li>`;
      }

      outEl.style.display = "block";
      outEl.innerHTML = `
        ${summaryHTML}
        <h3 style="margin:16px 0 6px;">Suggestions</h3>
        <ul style="margin:0 0 6px 18px;">${suggestionsHTML || "<li>Try lowering the goal amount or extending the timeline.</li>"}</ul>
      `;
      return;
    }

    // Feasible plan
    msgEl.innerHTML = "✅ <strong>This goal looks feasible.</strong> See the suggested saving cadence below.";
    msgEl.style.color = "#0b6b0b";

    const bufferTotal = maxSavable - savingGoal;
    const bufferPerDay = bufferTotal / durationDays;

    outEl.style.display = "block";
    outEl.innerHTML = `
      ${summaryHTML}
      <h3 style="margin:16px 0 6px;">Recommended Cadence</h3>
      <ul style="margin:0 0 6px 18px;">
        <li>Save about <strong>${g_currency(neededPerDay)}</strong> per day (${g_currency(neededPerWeek)} per week).</li>
        <li>Estimated buffer after reaching goal: <strong>${g_currency(bufferTotal)}</strong> (~${g_currency(bufferPerDay)}/day).</li>
      </ul>
    `;
  }
</script>
<!-- END Goals Tab Inner Content -->

        </div>
      </div>

      <!-- Bottom Navigation -->
      <button class="tablink" style="background-color: red;">
        <img src="assets/text_icon.png" class="icon" alt="goals"/>
        <br />Goals
      </button>
      <button class="tablink" onclick="window.location.href='log.html'">
        <img src="assets/lower_right_icon.png" class="icon" alt="log"/>
        <br />Log
      </button>
      <button class="tablink" onclick="window.location.href='index.html'">
        <img src="assets/colors_icon.png" class="icon" alt="home" />
        <br />Home
      </button>
      <button class="tablink" onclick="window.location.href='stats.html'">
        <img src="assets/user.png" class="icon" alt="stats" />
        <br />Stats
      </button>
      <button class="tablink" onclick="window.location.href='settings.html'">
        <img src="assets/choices_icon.png" class="icon" alt="settings"/>
        <br />Settings
      </button>
    </div>

    <script src="js/main.js"></script>
  </body>
</html>
